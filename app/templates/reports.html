{% extends "index.html" %}

{% block content %}
<header>
    <h1>HR Analytics</h1>
    <p>Real-time insights on workforce and expenditure.</p>
</header>

<div class="dashboard-stats"
    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px;">
    <div class="card">
        <h3 style="text-align: center;">Headcount by Department</h3>
        <canvas id="headcountChart"></canvas>
    </div>
    <div class="card">
        <h3 style="text-align: center;">Workforce Type</h3>
        <div style="max-width: 300px; margin: 0 auto;">
            <canvas id="workplaceChart"></canvas>
        </div>
    </div>
    <div class="card" style="grid-column: span 1;">
        <h3 style="text-align: center;">Salary Distribution</h3>
        <canvas id="salaryChart"></canvas>
    </div>
</div>

<script>
    fetch('/api/stats')
        .then(res => res.json())
        .then(data => {
            // 1. Headcount Chart (Bar)
            const ctx1 = document.getElementById('headcountChart').getContext('2d');
            new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: data.headcount.map(d => d.PEBEMPL_ORG_CODE_DIST || 'Unassigned'),
                    datasets: [{
                        label: 'Employee Count',
                        data: data.headcount.map(d => d.count),
                        backgroundColor: '#005239'
                    }]
                },
                options: { responsive: true }
            });

            // 2. Workplace Type (Pie)
            const ctx2 = document.getElementById('workplaceChart').getContext('2d');
            new Chart(ctx2, {
                type: 'pie',
                data: {
                    labels: data.workplace_types.map(w => w.NBRJOBS_WORKPLACE),
                    datasets: [{
                        data: data.workplace_types.map(w => w.count),
                        backgroundColor: ['#005239', '#FFC733', '#475569']
                    }]
                },
                options: { responsive: true }
            });

            // 3. Salary Distribution (Bar - simulated histogram)
            const ctx3 = document.getElementById('salaryChart').getContext('2d');
            const salaryBands = ["<50k", "50k-75k", "75k-100k", "100k-150k", "150k+"];
            const salaryCounts = [0, 0, 0, 0, 0];
            data.salaries.forEach(s => {
                if (s < 50000) salaryCounts[0]++;
                else if (s < 75000) salaryCounts[1]++;
                else if (s < 100000) salaryCounts[2]++;
                else if (s < 150000) salaryCounts[3]++;
                else salaryCounts[4]++;
            });

            new Chart(ctx3, {
                type: 'bar',
                data: {
                    labels: salaryBands,
                    datasets: [{
                        label: 'Number of Staff',
                        data: salaryCounts,
                        backgroundColor: '#FFC733'
                    }]
                },
                options: { responsive: true }
            });
        });
</script>
{% endblock %}